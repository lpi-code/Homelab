# Ansible Configuration for Homelab Infrastructure
# This configuration uses the dynamic inventory system and environment-first structure

[defaults]
# Use dynamic inventory script
inventory = shared/ansible/inventory/dynamic_inventory.py

# Host key checking
host_key_checking = False

# SSH configuration
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no
pipelining = True
timeout = 30

# Output configuration
stdout_callback = yaml
bin_ansible_callbacks = True

# Logging
log_path = ./ansible.log
display_skipped_hosts = False
display_ok_hosts = True

# Performance settings
forks = 10
gathering = smart
fact_caching = memory
fact_caching_timeout = 86400

# Role and collection paths
roles_path = shared/ansible/roles:environments/{{ env | default('dev') }}/ansible/roles
collections_path = shared/ansible/collections

# Variable precedence
vars_plugins_enabled = host_group_vars
variable_precedence = inventory_dir, inventory_file, inventory_script, inventory_dir_plugins, playbook_dir, playbook_dir_plugins

# Environment-specific settings
[inventory:shared/ansible/inventory/dynamic_inventory.py]
# Dynamic inventory script settings
env_var = ANSIBLE_ENVIRONMENT
debug_var = ANSIBLE_DEBUG

[privilege_escalation]
become = True
become_method = sudo
become_user = root
become_ask_pass = False

[ssh_connection]
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no
pipelining = True
control_path = /tmp/ansible-ssh-%%h-%%p-%%r
retries = 3

[galaxy]
server_list = galaxy, galaxy_community
roles_path = shared/ansible/roles
collections_path = shared/ansible/collections

[colors]
highlight = white
verbose = blue
warn = bright purple
error = red
debug = dark gray
deprecate = purple
skip = cyan
unreachable = red
ok = green
changed = yellow
diff_add = green
diff_remove = red
diff_lines = cyan

# Plugin configuration
[callback_plugins]
callback_plugins = shared/ansible/plugins/callback

[filter_plugins]
filter_plugins = shared/ansible/plugins/filter

[lookup_plugins]
lookup_plugins = shared/ansible/plugins/lookup

[action_plugins]
action_plugins = shared/ansible/plugins/action

# Environment-specific configuration
[env:dev]
# Development environment settings
inventory = shared/ansible/inventory/dynamic_inventory.py
extra_vars = @environments/dev/ansible/group_vars/dev/main.yaml
vault_password_file = secrets/dev_vault_pass

[env:staging]
# Staging environment settings
inventory = shared/ansible/inventory/dynamic_inventory.py
extra_vars = @environments/staging/ansible/group_vars/staging/main.yaml
vault_password_file = secrets/staging_vault_pass

[env:prod]
# Production environment settings
inventory = shared/ansible/inventory/dynamic_inventory.py
extra_vars = @environments/prod/ansible/group_vars/prod/main.yaml
vault_password_file = secrets/prod_vault_pass