# OpenWrt Network Configuration Template
# Generated by Ansible for {{ ansible_hostname | default('openwrt-router') }}
# Management IP: {{ ansible_host }}

# Global network configuration
config interface 'loopback'
	option device 'lo'
	option proto 'static'
	option ipaddr '127.0.0.1'
	option netmask '255.0.0.0'

# WAN interface (Management Network) - eth1
config interface 'wan'
	option device 'eth1'
	option proto 'static'
	option ipaddr '{{ ansible_host }}'
	option netmask '255.255.255.0'
	option gateway '{{ management_gateway | default("192.168.0.1") }}'
	option dns '8.8.8.8 8.8.4.4'

# LAN interface (Cluster Network) - eth0
config interface 'lan'
	option device 'eth0'
	option proto 'static'
	option ipaddr '{{ cluster_ip | default("10.10.0.200") }}'
	option netmask '255.255.255.0'

# Switch configuration for physical devices (if applicable)
{% if enable_switch_config is defined and enable_switch_config %}
config switch
	option name 'switch0'
	option reset '1'
	option enable_vlan '1'

config switch_vlan
	option device 'switch0'
	option vlan '1'
	option ports '0 1 2 3 4'
{% endif %}

# Additional interfaces for VLANs (if configured)
{% if vlan_interfaces is defined %}
{% for vlan in vlan_interfaces %}
config interface '{{ vlan.name }}'
	option device '{{ vlan.device }}.{{ vlan.id }}'
	option proto 'static'
	option ipaddr '{{ vlan.ip }}'
	option netmask '{{ vlan.netmask }}'
{% if vlan.gateway is defined %}
	option gateway '{{ vlan.gateway }}'
{% endif %}
{% endfor %}
{% endif %}

# DHCP configuration for LAN
config dhcp 'lan'
	option interface 'lan'
	option start '100'
	option limit '150'
	option leasetime '12h'
	option dhcpv6 'disabled'

# DHCP configuration for WAN (if needed)
{% if enable_wan_dhcp is defined and enable_wan_dhcp %}
config dhcp 'wan'
	option interface 'wan'
	option ignore '1'
{% endif %}

# Static routes (if configured)
{% if static_routes is defined %}
{% for route in static_routes %}
config route '{{ route.name }}'
	option target '{{ route.target }}'
	option netmask '{{ route.netmask }}'
	option gateway '{{ route.gateway }}'
{% endfor %}
{% endif %}

