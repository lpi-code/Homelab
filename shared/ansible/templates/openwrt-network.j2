# OpenWrt Network Configuration Template
# Generated by Ansible for {{ router_hostname | default('openwrt-router') }}

# Loopback interface
config interface 'loopback'
	option device 'lo'
	option proto 'static'
	option ipaddr '127.0.0.1'
	option netmask '255.0.0.0'

# WAN interface (Management Network)
config interface 'wan'
	option device 'eth1'
	option proto 'static'
	option ipaddr '{{ router_management_ip }}'
	option netmask '255.255.255.0'
	option gateway '{{ management_gateway }}'
	option dns '{{ dns_servers | join(" ") }}'

# LAN interface (Cluster Network)
config interface 'lan'
	option device 'eth0'
	option proto 'static'
	option ipaddr '{{ cluster_ip }}'
	option netmask '255.255.255.0'

{% if vlan_interfaces is defined %}
# VLAN interfaces
{% for vlan in vlan_interfaces %}
config interface '{{ vlan.name }}'
	option device '{{ vlan.device }}.{{ vlan.id }}'
	option proto 'static'
	option ipaddr '{{ vlan.ip }}'
	option netmask '{{ vlan.netmask }}'
{% if vlan.gateway is defined %}
	option gateway '{{ vlan.gateway }}'
{% endif %}
{% endfor %}
{% endif %}

{% if static_routes is defined %}
# Static routes
{% for route in static_routes %}
config route '{{ route.name }}'
	option target '{{ route.target }}'
	option netmask '{{ route.netmask }}'
	option gateway '{{ route.gateway }}'
{% endfor %}
{% endif %}

{% if enable_switch_config is defined and enable_switch_config %}
# Switch configuration
config switch
	option name 'switch0'
	option reset '1'
	option enable_vlan '1'

config switch_vlan
	option device 'switch0'
	option vlan '1'
	option ports '0 1 2 3 4'
{% endif %}

