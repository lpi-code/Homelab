# OpenWrt Firewall Configuration Template
# Generated by Ansible for {{ router_hostname | default('openwrt-router') }}

# Default zones configuration
{% for zone in firewall_zones %}
config zone '{{ zone.name }}'
	option name '{{ zone.name }}'
	option input '{{ zone.input }}'
	option output '{{ zone.output }}'
	option forward '{{ zone.forward }}'
{% if zone.masq is defined %}
	option masq '{{ zone.masq }}'
{% endif %}
{% if zone.mtu_fix is defined %}
	option mtu_fix '{{ zone.mtu_fix }}'
{% endif %}
{% if zone.network is defined %}
	option network '{{ zone.network }}'
{% endif %}

{% endfor %}

# Default forwarding rules
{% for forward in firewall_forwarding %}
config forwarding
	option src '{{ forward.src }}'
	option dest '{{ forward.dest }}'
{% endfor %}

# Default rules
{% for rule in firewall_rules %}
config rule '{{ rule.name }}'
{% if rule.src is defined %}
	option src '{{ rule.src }}'
{% endif %}
{% if rule.dest is defined %}
	option dest '{{ rule.dest }}'
{% endif %}
{% if rule.proto is defined %}
	option proto '{{ rule.proto }}'
{% endif %}
{% if rule.sport is defined %}
	option sport '{{ rule.sport }}'
{% endif %}
{% if rule.dest_port is defined %}
	option dest_port '{{ rule.dest_port }}'
{% endif %}
{% if rule.icmp_type is defined %}
	option icmp_type '{{ rule.icmp_type }}'
{% endif %}
	option target '{{ rule.target }}'

{% endfor %}

# Custom rules (if defined)
{% if custom_firewall_rules is defined %}
{% for rule in custom_firewall_rules %}
config rule '{{ rule.name }}'
{% if rule.src is defined %}
	option src '{{ rule.src }}'
{% endif %}
{% if rule.dest is defined %}
	option dest '{{ rule.dest }}'
{% endif %}
{% if rule.proto is defined %}
	option proto '{{ rule.proto }}'
{% endif %}
{% if rule.sport is defined %}
	option sport '{{ rule.sport }}'
{% endif %}
{% if rule.dest_port is defined %}
	option dest_port '{{ rule.dest_port }}'
{% endif %}
{% if rule.icmp_type is defined %}
	option icmp_type '{{ rule.icmp_type }}'
{% endif %}
{% if rule.family is defined %}
	option family '{{ rule.family }}'
{% endif %}
	option target '{{ rule.target }}'

{% endfor %}
{% endif %}

# Port forwarding rules (if defined)
{% if port_forwarding is defined %}
{% for forward in port_forwarding %}
config redirect '{{ forward.name }}'
	option src '{{ forward.src | default("wan") }}'
	option dest '{{ forward.dest | default("lan") }}'
	option proto '{{ forward.proto | default("tcp") }}'
	option dest_ip '{{ forward.dest_ip }}'
	option dest_port '{{ forward.dest_port }}'
	option src_dport '{{ forward.src_port }}'

{% endfor %}
{% endif %}

