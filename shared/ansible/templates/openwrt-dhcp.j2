# OpenWrt DHCP Configuration Template
# Generated by Ansible for {{ router_hostname | default('openwrt-router') }}

{% for interface, config in dhcp_config.items() %}
config dhcp '{{ interface }}'
{% if config.ignore is defined %}
	option ignore '{{ config.ignore }}'
{% endif %}
{% if config.start is defined %}
	option start '{{ config.start }}'
{% endif %}
{% if config.limit is defined %}
	option limit '{{ config.limit }}'
{% endif %}
{% if config.leasetime is defined %}
	option leasetime '{{ config.leasetime }}'
{% endif %}
{% if config.dhcpv6 is defined %}
	option dhcpv6 '{{ config.dhcpv6 }}'
{% endif %}
	option interface '{{ interface }}'
{% if config.domain is defined %}
	option domain '{{ config.domain }}'
{% endif %}
{% if config.dns is defined %}
	option dns '{{ config.dns }}'
{% endif %}

{% endfor %}

# DNS configuration
config dnsmasq
{% if dns_servers is defined %}
	list server '{{ dns_servers | join("' '") }}'
{% endif %}
	option domainneeded '1'
	option boguspriv '1'
	option filterwin2k '0'
	option localise_queries '1'
	option rebind_protection '1'
	option rebind_localhost '1'
	option local '/lan/'
	option domain 'lan'
	option expandhosts '1'
	option nonegcache '0'
	option authoritative '1'
	option readethers '1'
	option leasefile '/tmp/dhcp.leases'
	option resolvfile '/tmp/resolv.conf.auto'

{% if dhcp_hosts is defined %}
# Static DHCP hosts
{% for host in dhcp_hosts %}
config host
	option mac '{{ host.mac }}'
	option ip '{{ host.ip }}'
	option name '{{ host.name }}'

{% endfor %}
{% endif %}

{% if dns_records is defined %}
# Custom DNS records
{% for record in dns_records %}
config domain
	option name '{{ record.name }}'
	option ip '{{ record.ip }}'

{% endfor %}
{% endif %}

